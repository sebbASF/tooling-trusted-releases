exclude: ^node_modules/
repos:
- repo: meta
  hooks:
    - id: check-hooks-apply
      name: check that hooks apply
      description: check that all the hooks apply to the repository
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v6.0.0
  hooks:
    - id: check-ast
    - id: check-case-conflict
    - id: check-executables-have-shebangs
    - id: check-illegal-windows-names
    - id: check-json
    - id: check-merge-conflict
    - id: check-shebang-scripts-are-executable
    - id: check-toml
    - id: check-vcs-permalinks
    - id: check-yaml
    - id: detect-private-key
    - id: end-of-file-fixer
      exclude: ^atr/static/js/(ts|min)/|\.map$
    - id: fix-byte-order-marker
    - id: forbid-submodules
    - id: mixed-line-ending
    - id: trailing-whitespace
      exclude: ^atr/static/js/(ts|min)/
- repo: https://github.com/Lucas-C/pre-commit-hooks
  rev: v1.5.6
  hooks:
    - id: insert-license
      name: add a license for all Python files
      files: ^(atr|scripts|tests)/(.*\.py$|.*\.pyi)$
      args:
        - --comment-style
        - "|#|"
        - --license-filepath
        - scripts/ci/LICENSE-template.txt
        - --fuzzy-match-generates-todo
    - id: insert-license
      name: add a license for JS and TS files
      files: ^atr/static/(js/src/.*\.js|ts/.*\.ts)$
      args:
        - --comment-style
        - "/*| * |*/"
        - --license-filepath
        - scripts/ci/LICENSE-template.txt
        - --fuzzy-match-generates-todo
- repo: https://github.com/igorshubovych/markdownlint-cli
  rev: v0.47.0
  hooks:
    - id: markdownlint
      name: run Markdown lints
      description: check Markdown files with markdownlint
      args: [--config=.github/linters/.markdown-lint.yml]
      types: [markdown]
      files: \.md$
- repo: https://github.com/shellcheck-py/shellcheck-py
  rev: v0.11.0.1
  hooks:
    - id: shellcheck
- repo: https://github.com/rtts/djhtml
  rev: 3.0.10
  hooks:
    - id: djhtml
      files: .*/.*\.html$
    - id: djcss
      files: .*/atr.css$
#- repo: https://github.com/Riverside-Healthcare/djLint
#  rev: v1.36.4
#  hooks:
#    - id: djlint
#      files: "atr/templates/.*\\.html$"
#      types_or: ['html']
#      args:
#        - --profile=jinja
#        - --lint
#    - id: djlint
#      name: Format HTML templates
#      files: "atr/templates/.*\\.html$"
#      types_or: ['html']
#      args:
#        - --profile=jinja
#        - --reformat
- repo: https://github.com/thibaudcolas/pre-commit-stylelint
  rev: v16.26.1
  hooks:
    - id: stylelint
      additional_dependencies: ['stylelint@16.14.1', 'stylelint-config-standard@37.0.0']
      files: "atr/static/css/.*\\.css$"
      types_or: ['css']
      args: ['--fix', '--allow-empty-input']
- repo: https://github.com/woodruffw/zizmor-pre-commit
  rev: v1.20.0
  hooks:
    - id: zizmor
      args: [--min-severity, low]
- repo: https://github.com/pypa/pip-audit
  rev: v2.10.0
  hooks:
    - id: pip-audit
- repo: https://github.com/oxc-project/mirrors-oxlint
  rev: v1.39.0
  hooks:
    - id: oxlint
      name: lint JS files with Oxlint
      types: [javascript]
      files: ^atr/static/js/src/.*\.js$
      args:
        # These must be in the order deny, warn, allow
        - --deny=correctness
        - --deny=perf
        - --deny=suspicious
        - --deny=pedantic
        - --allow=unicorn/prefer-query-selector
# - repo: https://github.com/PyCQA/flake8
#   rev: 7.3.0
#   hooks:
#     - id: flake8
#       name: Flake8 (cognitive complexity and cohesion)
#       additional_dependencies:
#         - flake8-cognitive-complexity
#         # - flake8-expression-complexity
#         - flake8-cohesion
#       args:
#         - --max-line-length=120
#         - --select=CCR001,H601
#         # - --extend-ignore=E203,E251,E266,E402,F841
#         - --max-cognitive-complexity=20
#         # - --max-expression-complexity=7
#         - --cohesion-below=50.0
- repo: local
  hooks:
    - id: ruff
      name: lint Python files with Ruff
      entry: uv run --frozen ruff check --fix
      language: system
      types: [python]

    - id: ruff-format
      name: format Python files with Ruff
      entry: uv run --frozen ruff format --force-exclude
      language: system
      types: [python]

    - id: biome-format
      # Install biome from https://biomejs.dev/guides/manual-installation/
      # Avoid using NPM to install it until #359 is resolved
      name: format JS files with Biome
      entry: biome format --write --files-ignore-unknown=true --no-errors-on-unmatched --colors=off
      language: system
      types: [javascript]
      files: ^atr/static/js/src/.*\.js$

    - id: biome-check
      # Install biome from https://biomejs.dev/guides/manual-installation/
      # Avoid using NPM to install it until #359 is resolved
      name: lint JS files with Biome
      entry: biome check --write --error-on-warnings --files-ignore-unknown=true --no-errors-on-unmatched --colors=off
      language: system
      types: [javascript]
      files: ^atr/static/js/src/.*\.js$

    - id: pyright
      name: type check Python files with Pyright
      entry: uv run --frozen pyright
      language: system
      require_serial: true
      types: [python]
      exclude: ^tests/

    - id: jinja-route-check
      name: check Jinja2 routes
      description: Check whether routes used in Jinja2 templates actually exist
      entry: uv run --frozen python scripts/lint/jinja_route_checker.py
      language: system
      pass_filenames: false
      always_run: true

    - id: check-when-dependencies-updated
      name: check when dependencies were updated
      description: Verify that dependencies were updated within the configured timeframe, for ASVS 15.2.1
      entry: uv run --frozen python scripts/check_when_dependencies_updated.py
      language: system
      pass_filenames: false
      always_run: true
